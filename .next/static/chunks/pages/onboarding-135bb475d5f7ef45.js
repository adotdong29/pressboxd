(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[627],{1614:(e,a,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/onboarding",function(){return t(9294)}])},9294:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>o});var r=t(7876),l=t(4232),s=t(5605),n=t(482),i=t(43);function o(){let e=(0,s.useRouter)(),{user:a,loading:t}=(0,i.A)(),[o,u]=(0,l.useState)(null),[c,d]=(0,l.useState)(""),[m,g]=(0,l.useState)(""),[f,p]=(0,l.useState)(null),[b,h]=(0,l.useState)(""),[x,N]=(0,l.useState)(""),[w,v]=(0,l.useState)(!1),[j,y]=(0,l.useState)(!0);(0,l.useEffect)(()=>{(async()=>{try{let{data:{session:e},error:a}=await n.N.auth.getSession();a?console.error("Error fetching session in Onboarding:",a):(console.log("Onboarding: direct getSession returned:",e),u((null==e?void 0:e.user)||null))}catch(e){console.error("Onboarding: exception in getSession:",e)}})()},[]);let S=o||a;if((0,l.useEffect)(()=>{(async function(){if(S){let{data:a,error:t}=await n.N.from("profiles").select("username").eq("id",S.id).single();if(t)console.error("Error checking onboarding status:",t);else if(a&&a.username){e.replace("/app");return}}y(!1)})()},[S,e]),t||j)return(0,r.jsx)("div",{children:"Loading..."});if(!S)return e.replace("/login"),(0,r.jsx)("div",{children:"Redirecting to login..."});let _=async a=>{a.preventDefault(),v(!0);let t=S;if(!t){let{data:{session:e}}=await n.N.auth.getSession();t=null==e?void 0:e.user}if(!t){h("No active session. Please log in again."),v(!1);return}let r=t.id,l=null;if(f){let e=f.name.split(".").pop(),a="".concat(r,"_").concat(Date.now(),".").concat(e),{error:t}=await n.N.storage.from("avatars").upload(a,f);if(t){h("Image upload failed: ".concat(t.message)),v(!1);return}let{data:s}=n.N.storage.from("avatars").getPublicUrl(a);l=s.publicUrl}let s={id:r,username:c,bio:m,avatar_url:l,updated_at:new Date},{error:i}=await n.N.from("profiles").upsert(s,{returning:"minimal"});i?h("Profile update failed: ".concat(i.message)):(N("Profile updated successfully!"),setTimeout(()=>e.push("/app"),2e3)),v(!1)};return(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:(0,r.jsxs)("form",{onSubmit:_,className:"bg-white p-8 rounded shadow-md w-full max-w-lg",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Complete Your Onboarding"}),b&&(0,r.jsx)("p",{className:"text-red-500 mb-4",children:b}),x&&(0,r.jsx)("p",{className:"text-green-500 mb-4",children:x}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-gray-700 mb-2",children:"Profile Picture"}),(0,r.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var a;(null===(a=e.target.files)||void 0===a?void 0:a.length)&&p(e.target.files[0])},className:"w-full p-2 border rounded"})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-gray-700 mb-2",children:"Username"}),(0,r.jsx)("input",{type:"text",value:c,onChange:e=>d(e.target.value),className:"w-full p-2 border rounded",placeholder:"Enter your username",required:!0})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-gray-700 mb-2",children:"Bio"}),(0,r.jsx)("textarea",{value:m,onChange:e=>g(e.target.value),className:"w-full p-2 border rounded",placeholder:"Tell us about yourself",rows:"4",required:!0})]}),(0,r.jsx)("button",{type:"submit",className:"bg-blue-500 text-white py-2 px-4 rounded w-full",disabled:w,children:w?"Saving...":"Complete Onboarding"})]})})}}},e=>{var a=a=>e(e.s=a);e.O(0,[593,636,792],()=>a(1614)),_N_E=e.O()}]);